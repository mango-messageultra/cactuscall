<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cactus Call</title>
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCouV7muX7zFi5-XsK99nLd1PAzH739okE",
            authDomain: "cactus-call.firebaseapp.com",
            databaseURL: "https://cactus-call-default-rtdb.firebaseio.com/",
            projectId: "cactus-call",
            storageBucket: "cactus-call.firebasestorage.app",
            messagingSenderId: "533842483928",
            appId: "1:533842483928:web:07fd76e1b5beb8154c55ad",
            measurementId: "G-8VJDZB2Z90"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Generate a random room code
        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        // Create a new room and store it in Firebase
        async function createRoom() {
            const roomCode = generateRoomCode();
            const roomRef = ref(database, `rooms/${roomCode}`);
            await set(roomRef, {
                createdAt: Date.now(),
                participants: []
            });
            alert(`Room created! Share this code: ${roomCode}`);
            return roomCode;
        }

        // Join an existing room
        async function joinRoom(roomCode) {
            const roomRef = ref(database, `rooms/${roomCode}`);
            const roomSnapshot = await get(roomRef);

            if (roomSnapshot.exists()) {
                alert(`Joined room: ${roomCode}`);
                return roomCode;
            } else {
                alert("Room not found. Please check the code.");
                return null;
            }
        }

        // Start video functionality (for local testing)
        async function startVideo() {
            const localVideo = document.getElementById("local-video");
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                localVideo.srcObject = stream;
            } catch (error) {
                console.error("Error accessing media devices:", error);
                alert("Unable to access camera and microphone.");
            }
        }

        // Event listeners for room controls
        document.addEventListener("DOMContentLoaded", () => {
            const createRoomButton = document.getElementById("create-room");
            const joinRoomButton = document.getElementById("join-room");
            const roomCodeInput = document.getElementById("room-code");

            createRoomButton.addEventListener("click", async () => {
                const roomCode = await createRoom();
                if (roomCode) {
                    startVideo(); // Start video after creating a room
                }
            });

            joinRoomButton.addEventListener("click", async () => {
                const roomCode = roomCodeInput.value.trim().toUpperCase();
                if (!roomCode) {
                    alert("Please enter a room code.");
                    return;
                }
                const joinedRoom = await joinRoom(roomCode);
                if (joinedRoom) {
                    startVideo(); // Start video after joining a room
                }
            });
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f5f5dc;
        }
        header {
            background-color: #2e8b57;
            color: white;
            padding: 10px;
        }
        .controls, .room-controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            background-color: #2e8b57;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        input {
            padding: 10px;
            width: 200px;
            margin-right: 10px;
        }
        video {
            width: 60%;
            margin-top: 20px;
            border: 2px solid #2e8b57;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Cactus Call</h1>
    </header>
    <div class="room-controls">
        <button id="create-room">Create Room</button>
        <p>OR</p>
        <input type="text" id="room-code" placeholder="Enter Room Code">
        <button id="join-room">Join Room</button>
    </div>
    <video id="local-video" autoplay playsinline muted></video>
</body>
</html>
